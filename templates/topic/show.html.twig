{% extends 'base.html.twig' %}

{% block breadcrumbs %}
	&rarr; <a href = "{{path("thread_show", {id: topic.thread.id})}}"> {{ topic.thread.name }}</a>
	&rarr; <a href = "#"> {{ topic.title }}</a>
{% endblock %}

{% block body %}
	<div id="topic_show">
		<div class="banner text-center py-3 ps-2 text-white">{{topic.title}}</div>

		<div id = "topic" class = "p-2 position-relative">
			<div class="date text-end fw-bold pe-2">{{topic.date|date("d F Y H:i:s")}}</div>
			<div class = "pb-2">{{topic.text}}</div>
			<div class = "d-flex">
				<div class="author w-100"><span class = "fw-bold">Author:</span> {{topic.user.email}}</div>
				{% if app.user %} <a href="{{path("post_create", {topic_id: topic.id})}}" class="px-3 py-1">Napisz&nbsp;posta</a> {% endif %}
			</div>
		</div>

		{% if topic.posts is empty %}
			<div class="text-center fw-bold">Tu jeszcze nic nie ma</div>
		{% else %}
			<div class="items">
				{% for post in topic.posts %}
					<div class="bg-light d-flex item">
						<div class = "col-2 col-sm-1 position-relative">
							<img class="avatar center d-block p-2" src="{{ asset('images/avatar.png') }}"/>
						</div>

						<div class = "col-10 col-sm-11 p-3 pb-1">
							<div><span class = "fw-bold">{{post.user.email}}</span>, {{post.date|ago}}</div>
							<div>{{post.text}}</div>

							<div class = "d-flex py-1 px-2">
								{% if app.user and app.user.id == post.user.id  %}
									<span class = "me-auto"></span>
									<a href = "{{path("post_delete", {id: post.id})}}" class = "pe-2">Usuń</a>
									<a href="{{path("post_edit", { id: post.id } ) }}" class = "pe-2">Edytuj</a>
									<a href = "{{path("comment_create", {post_id:post.id})}}" class = "">Napisz&nbsp;komentarz</a>
								{% endif %}
							</div>
							{% if post.comments is empty %}
							{% else %}
								{% for comment in post.comments %}
								<div class = "comment pt-2 border-top">
									<div class = "d-flex">
										<img class = "avatar" src="{{ asset('images/avatar.png') }}"/>
										<div class = "ms-2">
											<div class = "fw-bold">{{comment.user.email}}</div>
											<div class = "">{{comment.date|ago}}</div>
										</div>
									</div>
									<div class = "">{{comment.text}}</div>
									{% if app.user and app.user.id == comment.user.id %}
										<div class = "d-flex">
											<span class = "me-auto"></span>
											<a class="pe-2" href = "{{path("comment_edit", {id: comment.id})}}">Edytuj</a>
											<a class="pe-2" href = "{{path("comment_delete", {id: comment.id})}}">Usuń</a>
										</div>
									{% endif %}
								</div>
								{% endfor %}
							{% endif %}
						</div>
					</div>
				{% endfor %}
			</div>
		{% endif %}
	</div>
{% endblock %}
